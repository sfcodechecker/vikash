<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Agentforce - Render Chat In Page</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>

  </style>
</head>
<body>
  

  <!-- --- Your existing init script and bootstrap loader --- -->
  <script type="text/javascript">
    function initEmbeddedMessaging() {
      try {
        if (window.embeddedservice_bootstrap) {
          embeddedservice_bootstrap.settings.language = 'en_US';
          embeddedservice_bootstrap.settings.hideChatButtonOnLoad = true;
          embeddedservice_bootstrap.init(
            '00DgK00000DVffJ',
            'BH_Test_Messaging_Setting',
            'https://orgfarm-c20f71d007-dev-ed.develop.my.site.com/ESWBHTestMessagingSett1760515635748',
            {
              scrt2URL: 'https://orgfarm-c20f71d007-dev-ed.develop.my.salesforce-scrt.com'
            }
          );
          console.log('Embedded Messaging initialized.');
        setTimeout(() => {
          embeddedservice_bootstrap.utilAPI.launchChat();
          try{
            embeddedservice_bootstrap.utilAPI.hideChatButton();
          }catch(e){

          }
        }, 2000);
          
        } else {
          console.warn('embeddedservice_bootstrap not defined at init time.');
        }
      } catch (err) {
        console.error('Error initializing Embedded Messaging:', err);
      }
    }

    function launchChat() {
        embeddedservice_bootstrap.utilAPI.launchChat()
            .then(() => {
                // Success handler used to perform actions
                // when the chat client launches successfully.
                // For example, create a method that disables the launch chat button.
                //disableLaunchChatButton();
            }).catch(() => {
                // Error handler used to perform actions
                // if the chat client fails to launch.
                // For example, create a method that hides the launch chat button.
                hideLaunchChatButton();
            }).finally(() => {
                // Finally handler used to perform any clean-up actions
                // regardless of whether the chat client launches successfully or not.
                // For example, create a method that logs the userâ€™s attempt to chat.
                logEndUserAttemptToChat();
            });
    }
  </script>

  <script src="https://orgfarm-c20f71d007-dev-ed.develop.my.site.com/ESWBHTestMessagingSett1760515635748/assets/js/bootstrap.min.js" onload="initEmbeddedMessaging();"></script>
  
  <!--<script type="text/javascript">
    /***** Utility: try to call launchChat with retries *****/
    function tryLaunchChatWithRetries({ intervalMs = 10000, maxAttempts = 100 } = {}) {
      let attempts = 0;
      return new Promise((resolve, reject) => {
        const timer = setInterval(() => {
          attempts++;
          const util = window.embeddedservice_bootstrap?.utilAPI;
          if (util && typeof util.launchChat === 'function') {
            clearInterval(timer);
            util.launchChat()
              .then(() => resolve(util))
              .catch((err) => reject(err));
            return;
          }
          if (attempts >= maxAttempts) {
            clearInterval(timer);
            reject(new Error('launchChat not available within timeout'));
          }
        }, intervalMs);
      });
    }

    /***** Utility: wait for injected sidebar element *****/
    function waitForInjectedSidebar({ intervalMs = 300, maxAttempts = 40 } = {}) {
      let attempts = 0;
      return new Promise((resolve, reject) => {
        const t = setInterval(() => {
          attempts++;
          // Salesforce commonly injects an element with this class
          const injected = document.querySelector('.embeddedServiceSidebar');
          if (injected) {
            clearInterval(t);
            resolve(injected);
            return;
          }
          if (attempts >= maxAttempts) {
            clearInterval(t);
            reject(new Error('embeddedServiceSidebar not found'));
          }
        }, intervalMs);
      });
    }

    /***** Move the injected chat into our page container and adapt styles *****/
    function hostChatInPage(injectedEl) {
      try {
        const host = document.getElementById('chat-card-body');
        if (!host) throw new Error('chat-card-body not found');

        // If it's already hosted, skip
        if (host.contains(injectedEl)) {
          console.log('Chat already hosted in page.');
          return;
        }

        // Remove messenger's fixed positioning and make it behave as a child
        injectedEl.classList.add('embedded-as-child');

        // Append the injected chat element as a child of our host container
        host.appendChild(injectedEl);

        // Make host visible
        const chatHostOuter = document.getElementById('chat-host');
        chatHostOuter.classList.add('visible');
        chatHostOuter.setAttribute('aria-hidden', 'false');

        console.log('Chat moved into page host.');
      } catch (err) {
        console.error('Failed to host chat in page:', err);
      }
    }

    /***** Restore (if you want to move it back out) - optional *****/
    function restoreInjectedSidebar(injectedEl) {
      try {
        // Remove our class and attempt to put it back to body
        injectedEl.classList.remove('embedded-as-child');
        document.body.appendChild(injectedEl);
        const chatHostOuter = document.getElementById('chat-host');
        chatHostOuter.classList.remove('visible');
        chatHostOuter.setAttribute('aria-hidden', 'true');
        console.log('Chat restored to original location.');
      } catch (err) {
        console.error('Failed to restore chat:', err);
      }
    }

    /***** Public flow: open chat inline on page *****/
    async function openChatInline() {
      try {
        // Launch chat (if the embed util is present) and then reposition once injected
        await tryLaunchChatWithRetries({ intervalMs: 500, maxAttempts: 20 });

        // Wait for the sidebar element to be created
        const injected = await waitForInjectedSidebar({ intervalMs: 300, maxAttempts: 40 });

        // Host it inside our page
        hostChatInPage(injected);
      } catch (err) {
        console.warn('Could not open chat inline:', err);
      }
    }

    /***** Close handler: hide the host and optionally restore the chat node *****/
    function closeChatInline() {
      const chatHostOuter = document.getElementById('chat-host');
      const injected = document.querySelector('.embeddedServiceSidebar');
      if (injected && chatHostOuter && chatHostOuter.contains(injected)) {
        // Option A: hide the host only (keep node inside)
        chatHostOuter.classList.remove('visible');
        chatHostOuter.setAttribute('aria-hidden', 'true');

        // Option B: restore back into body (uncomment if you prefer)
        // restoreInjectedSidebar(injected);
      } else {
        // Nothing to hide
        chatHostOuter.classList.remove('visible');
        chatHostOuter.setAttribute('aria-hidden', 'true');
      }
    }

    
  </script>-->
</body>
</html>

